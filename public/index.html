<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Bingo Multiplayer</title>
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
background: #0c0c1a;
color: white;
padding: 15px;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
.container { max-width: 1200px; margin: 0 auto; }
#login-screen { text-align: center; margin: 60px auto; max-width: 500px; }
#game-area { display: none; }
.header {
text-align: center;
margin-bottom: 20px;
padding: 15px;
background: rgba(0, 0, 0, 0.3);
border-radius: 12px;
border: 1px solid #5d4037;
box-shadow: 0 4px 12px rgba(0,0,0,0.5);
}
.header h2 {
font-size: 1.8em;
margin-bottom: 10px;
color: gold;
text-shadow: 0 0 8px rgba(255,215,0,0.6);
}
.player-info { font-size: 1.1em; margin: 8px 0; }
#pot-display, #jackpot-display {
font-weight: bold;
margin-top: 6px;
font-size: 1.2em;
}
#pot-display { color: #4CAF50; }
#jackpot-display { color: #ff6b6b; }
.players-section { margin: 20px 0; display: flex; gap: 20px; }
.players-column {
flex: 1;
background: rgba(30, 30, 50, 0.7);
border-radius: 10px;
padding: 15px;
border: 1px solid #3a3a5a;
}
.players-column h3 {
margin-bottom: 15px;
text-align: center;
color: gold;
font-size: 1.2em;
}
.players-list {
max-height: 200px;
overflow-y: auto;
}
.players-list ul {
list-style: none;
display: flex;
flex-direction: column;
gap: 8px;
padding: 0;
}
.players-list li {
background: #1e3a8a;
padding: 8px 12px;
border-radius: 8px;
font-size: 0.95em;
color: white;
transition: all 0.3s;
border: 1px solid #2c5282;
display: flex;
justify-content: space-between;
}
.players-list li.x-out {
color: #ff6b6b !important;
font-weight: bold;
}
.players-list li.winner {
background: #2e7d32 !important;
border-color: #1b5e20;
box-shadow: 0 0 10px rgba(46, 125, 50, 0.7);
}
.ranking-section {
margin: 20px 0;
background: rgba(25, 25, 45, 0.8);
border-radius: 12px;
padding: 15px;
border: 1px solid #4a235a;
}
.ranking-section h3 {
text-align: center;
margin-bottom: 15px;
color: gold;
font-size: 1.3em;
}
.ranking-list {
max-height: 300px;
overflow-y: auto;
}
.ranking-list ul {
list-style: none;
padding: 0;
}
.ranking-list li {
display: flex;
justify-content: space-between;
padding: 10px;
margin-bottom: 8px;
background: rgba(30, 30, 50, 0.7);
border-radius: 8px;
border-left: 4px solid gold;
}
.ranking-list li:nth-child(1) { border-left-color: gold; }
.ranking-list li:nth-child(2) { border-left-color: silver; }
.ranking-list li:nth-child(3) { border-left-color: #cd7f32; }
.ranking-position { font-weight: bold; min-width: 30px; }
.ranking-name { flex: 1; margin: 0 10px; }
.ranking-chips { font-weight: bold; color: #4CAF50; }
.controls {
display: flex;
flex-wrap: wrap;
gap: 10px;
justify-content: center;
margin: 20px 0;
padding: 15px;
background: rgba(25, 25, 45, 0.6);
border-radius: 12px;
}
.controls button {
padding: 10px 16px;
font-weight: bold;
border: none;
border-radius: 8px;
cursor: pointer;
transition: all 0.2s;
min-width: 100px;
}
.controls button:hover {
transform: translateY(-2px);
box-shadow: 0 4px 8px rgba(0,0,0,0.4);
}
#buy-btn { background: #1976d2; }
#start-btn { background: #388e3c; }
#restart-btn { background: #d32f2f; }
#line1-btn { background: #2e7d32; color: white; }
#line2-btn { background: #7b1fa2; color: white; }
#bingo-btn { background: gold; color: #1a1a2e; font-weight: bold; }
.draw-area {
text-align: center;
margin: 20px 0;
padding: 15px;
background: rgba(20, 20, 35, 0.7);
border-radius: 12px;
}
.history {
display: flex;
flex-wrap: wrap;
gap: 8px;
justify-content: center;
max-height: 100px;
overflow-y: auto;
margin-top: 15px;
padding: 10px;
background: rgba(0,0,0,0.3);
border-radius: 8px;
}
.ball {
width: 40px;
height: 40px;
background: linear-gradient(135deg, #ffd700, #daa520);
border-radius: 50%;
display: flex;
justify-content: center;
align-items: center;
font-weight: bold;
color: #1a1a2e;
font-size: 1.1em;
box-shadow: 0 2px 6px rgba(0,0,0,0.4);
animation: popIn 0.3s;
}
@keyframes popIn {
from { transform: scale(0); opacity: 0; }
to { transform: scale(1); opacity: 1; }
}
.cards-container {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
gap: 25px;
margin-top: 25px;
}
.card-wrapper {
background: #121826;
padding: 16px;
border-radius: 14px;
position: relative;
transition: all 0.3s;
border: 2px solid #2c3e50;
box-shadow: 0 6px 15px rgba(0,0,0,0.5);
}
.card-wrapper:hover {
transform: translateY(-5px);
box-shadow: 0 10px 25px rgba(0,0,0,0.7);
border-color: #3498db;
}
.card-wrapper.bingo-complete {
background: gold !important;
color: #1a1a2e;
border-color: gold;
box-shadow: 0 0 25px gold, 0 10px 30px rgba(255,215,0,0.6) !important;
animation: pulseGold 1.5s infinite alternate;
}
/* ‚úÖ Borda dourada s√≥ quando faltar 1 bola para a fase ATUAL */
.card-wrapper.near-win {
border: 2px solid gold;
box-shadow: 0 0 15px rgba(255,215,0,0.6);
animation: glowBorder 1.5s infinite alternate;
}
@keyframes glowBorder {
0% { box-shadow: 0 0 10px gold; }
100% { box-shadow: 0 0 25px gold; }
}
.card-title {
text-align: center;
margin-bottom: 12px;
font-weight: bold;
font-size: 1.2em;
color: #ecf0f1;
letter-spacing: 1px;
}
.grid-90 {
display: grid;
grid-template-columns: repeat(9, 1fr);
gap: 2px;
background: #2c3e50;
padding: 4px;
border-radius: 8px;
}
.cell {
aspect-ratio: 1;
display: flex;
justify-content: center;
align-items: center;
background: #1e293b;
font-weight: bold;
font-family: 'Arial Black', 'Arial Bold', sans-serif;
font-size: 1.3em;
color: #f1f1f1;
border-radius: 6px;
transition: all 0.2s;
position: relative;
overflow: hidden;
}
.cell.empty {
background: transparent;
border: 1px dashed #3a3a5a;
}
.cell.marked {
background: linear-gradient(135deg, #ef4444, #b91c1c) !important;
color: white !important;
transform: scale(0.95);
box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
}
.cell.free {
background: gold;
color: #1a1a2e;
}
.stage-linha1 #line2-btn,
.stage-linha1 #bingo-btn,
.stage-linha2 #line1-btn,
.stage-linha2 #bingo-btn,
.stage-bingo #line1-btn,
.stage-bingo #line2-btn {
display: none !important;
}
#admin-message {
position: fixed;
top: 10px;
left: 50%;
transform: translateX(-50%);
background: #4CAF50;
color: white;
padding: 12px 24px;
border-radius: 8px;
z-index: 2000;
display: none;
text-align: center;
box-shadow: 0 4px 12px rgba(0,0,0,0.4);
}
/* ‚úÖ Estilo do Chat */
#chat-container {
margin: 20px 0;
background: rgba(25, 25, 45, 0.8);
border-radius: 12px;
padding: 15px;
border: 1px solid #4a235a;
}
#chat-messages {
height: 120px;
overflow-y: auto;
padding: 10px;
background: rgba(0,0,0,0.3);
border-radius: 8px;
margin-bottom: 10px;
font-size: 0.95em;
}
#chat-messages p {
margin: 4px 0;
padding: 3px 6px;
border-radius: 5px;
}
#chat-messages .bot { background: #2c3e50; color: #7fb3d5; }
#chat-messages .human { background: #1e3a8a; color: #bbdefb; }
#chat-messages .system { background: #2e7d32; color: #c8e6c9; font-style: italic; }
#chat-input-container {
display: flex;
gap: 8px;
}
#chat-input {
flex: 1;
padding: 8px;
border-radius: 6px;
border: 1px solid #3a3a5a;
background: #0c0c1a;
color: white;
}
#chat-send {
padding: 8px 16px;
background: #e91e63;
color: white;
border: none;
border-radius: 6px;
cursor: pointer;
}
/* ============ ANIMA√á√ïES PERSONALIZADAS ============ */
/* LINHA 1 */
#line-victory-overlay {
position: fixed;
inset: 0;
background: radial-gradient(circle, rgba(0, 50, 100, 0.4) 0%, #000 100%);
display: flex;
justify-content: center;
align-items: center;
z-index: 100;
opacity: 0;
visibility: hidden;
transition: all 0.5s ease;
}
#line-victory-overlay.active {
opacity: 1;
visibility: visible;
}
.line-card {
position: relative;
z-index: 110;
width: 92%;
max-width: 380px;
background: rgba(0, 0, 0, 0.9);
backdrop-filter: blur(16px);
-webkit-backdrop-filter: blur(16px);
border: 2px solid #00d2ff;
border-radius: 28px;
padding: 28px 16px;
text-align: center;
box-shadow: 0 0 40px rgba(0, 210, 255, 0.3);
transform: translateY(20px) scale(0.92);
transition: all 0.6s cubic-bezier(0.17, 0.89, 0.32, 1.49);
overflow: hidden;
}
.active .line-card { transform: translateY(0) scale(1); }
.line-title {
font-family: 'Goldman', cursive;
font-size: clamp(1.6rem, 7.5vw, 2.2rem);
color: #00d2ff;
text-shadow: 0 0 12px #00d2ff;
margin-bottom: 8px;
text-transform: uppercase;
letter-spacing: 1px;
}
.winner-name {
font-size: clamp(1.0rem, 4.8vw, 1.4rem);
color: #fff;
font-weight: 900;
margin-bottom: 18px;
display: block;
text-transform: uppercase;
letter-spacing: 1px;
}
.chips-box {
background: rgba(255, 255, 255, 0.05);
border: 1px solid rgba(0, 210, 255, 0.3);
border-radius: 18px;
padding: 18px 10px;
margin-bottom: 12px;
}
.prize-chips {
font-size: clamp(2.2rem, 10vw, 3.4rem);
font-weight: 900;
color: #fff;
text-shadow: 0 0 16px #00d2ff;
}
.chip-label {
font-size: 0.85rem;
color: #00d2ff;
letter-spacing: 3px;
font-weight: bold;
text-transform: uppercase;
}
.chip-particle {
position: absolute;
width: 36px;
height: 36px;
border-radius: 50%;
border: 3px dashed rgba(255,255,255,0.7);
display: flex;
justify-content: center;
align-items: center;
font-weight: bold;
color: white;
font-size: 11px;
pointer-events: none;
z-index: 105;
box-shadow: inset 0 0 8px rgba(0,0,0,0.5);
}
.c-blue { background: #00d2ff; box-shadow: 0 0 12px #00d2ff; }
.c-red { background: #ff4b2b; box-shadow: 0 0 12px #ff4b2b; }
.c-green { background: #00ff87; box-shadow: 0 0 12px #00ff87; }
.c-purple { background: #a800ff; box-shadow: 0 0 12px #a800ff; }
@keyframes chipFly {
0% { transform: translateY(110vh) rotate(0deg); opacity: 1; }
100% { transform: translateY(-20vh) rotate(720deg); opacity: 0; }
}
/* LINHA 2 */
#line2-victory-overlay {
position: fixed;
inset: 0;
background: radial-gradient(circle at center, #002d1a 0%, #000 100%);
display: flex;
justify-content: center;
align-items: center;
z-index: 100;
opacity: 0;
visibility: hidden;
transition: all 0.5s ease;
}
#line2-victory-overlay.active {
opacity: 1;
visibility: visible;
}
.rays-emerald {
position: absolute;
width: 300%;
height: 300%;
background: conic-gradient(from 0deg, transparent 0%, rgba(0, 255, 135, 0.06) 15%, transparent 30%);
animation: rotate 25s linear infinite;
z-index: 1;
}
.line-frame {
position: relative;
z-index: 20;
width: 92%;
max-width: 380px;
background: rgba(0, 0, 0, 0.9);
backdrop-filter: blur(20px);
-webkit-backdrop-filter: blur(20px);
border: 2px solid #00ff87;
border-radius: 32px;
padding: 30px 12px;
text-align: center;
box-shadow: 0 0 40px rgba(0, 255, 135, 0.2);
overflow: hidden;
animation: popIn 0.6s cubic-bezier(0.17, 0.89, 0.32, 1.49) forwards;
}
.line-header {
font-family: 'Goldman', cursive;
font-size: clamp(1.8rem, 8.5vw, 2.6rem);
background: linear-gradient(to bottom, #00ff87, #00f2fe);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
margin-bottom: 8px;
text-transform: uppercase;
letter-spacing: 1.5px;
}
.chips-box {
background: rgba(0, 255, 135, 0.05);
border: 1px solid rgba(0, 255, 135, 0.3);
border-radius: 18px;
padding: 20px 10px;
margin: 0 auto;
width: 90%;
}
.chips-amount {
font-size: clamp(2.0rem, 9.5vw, 3.6rem);
font-weight: 900;
color: #fff;
text-shadow: 0 0 16px #00ff87;
}
.sub-label {
margin-top: 12px;
color: #00ff87;
font-weight: bold;
letter-spacing: 2.5px;
font-size: 0.78rem;
}
.chip {
position: absolute;
width: 36px;
height: 36px;
border-radius: 50%;
border: 3px dashed rgba(255,255,255,0.7);
display: flex;
justify-content: center;
align-items: center;
font-weight: bold;
color: white;
font-size: 12px;
z-index: 5;
pointer-events: none;
}
.c-emerald { background: #00ff87; box-shadow: 0 0 12px #00ff87; }
.c-turquoise { background: #00f2fe; box-shadow: 0 0 12px #00f2fe; }
.c-gold { background: #ffeb3b; color: #000; border-color: #000; box-shadow: 0 0 12px #ffeb3b; }
@keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
@keyframes popIn { from { transform: scale(0.7); opacity: 0; } to { transform: scale(1); opacity: 1; } }
@keyframes chipFall {
0% { transform: translateY(-10vh) rotate(0deg); }
100% { transform: translateY(110vh) rotate(720deg); }
}
/* BINGO */
#bingo-victory-overlay {
position: fixed;
inset: 0;
background: radial-gradient(circle, rgba(100, 80, 0, 0.4) 0%, #000 100%);
display: flex;
justify-content: center;
align-items: center;
z-index: 100;
opacity: 0;
visibility: hidden;
transition: all 0.5s ease;
}
#bingo-victory-overlay.active {
opacity: 1;
visibility: visible;
}
.bingo-card {
position: relative;
z-index: 110;
width: 94%;
max-width: 400px;
background: rgba(0, 0, 0, 0.95);
backdrop-filter: blur(12px);
-webkit-backdrop-filter: blur(12px);
border: 3px solid #FFD700;
border-radius: 36px;
padding: 34px 10px;
text-align: center;
box-shadow: 0 0 40px rgba(255, 215, 0, 0.3);
transform: scale(0.55);
opacity: 0;
animation: bingoEntry 0.6s cubic-bezier(0.17, 0.89, 0.32, 1.49) forwards;
}
@keyframes bingoEntry {
to { transform: scale(1); opacity: 1; }
}
.bingo-title {
font-family: 'Goldman', cursive;
font-size: clamp(2.2rem, 10vw, 3.6rem);
color: #FFD700;
text-shadow: 0 0 16px rgba(255, 215, 0, 0.5);
margin-bottom: 8px;
text-transform: uppercase;
letter-spacing: 3px;
}
.prize-container {
background: rgba(255, 215, 0, 0.05);
border: 2px solid rgba(255, 215, 0, 0.3);
border-radius: 22px;
padding: 22px 5px;
margin: 0 auto;
width: 95%;
min-height: 90px;
display: flex;
justify-content: center;
align-items: center;
}
.prize-amount {
font-size: clamp(1.6rem, 8.5vw, 3.2rem);
font-weight: 900;
color: #fff;
text-shadow: 0 0 16px #FFD700;
white-space: nowrap;
}
.sub-tag {
margin-top: 20px;
font-size: 0.85rem;
color: #FFD700;
letter-spacing: 4px;
font-weight: bold;
text-transform: uppercase;
}
.particle {
position: absolute;
width: 32px;
height: 32px;
border-radius: 50%;
border: 3px dashed rgba(255,255,255,0.8);
z-index: 5;
pointer-events: none;
}
.p-gold { background: #FFD700; box-shadow: 0 0 12px #FFD700; }
.p-emerald { background: #00ff87; box-shadow: 0 0 12px #00ff87; }
.p-blue { background: #00d2ff; box-shadow: 0 0 12px #00d2ff; }
@keyframes fall {
0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
}
/* JACKPOT */
#jackpot-overlay {
position: fixed;
inset: 0;
background: radial-gradient(circle at center, #500000 0%, #000 100%);
display: flex;
justify-content: center;
align-items: center;
z-index: 100;
opacity: 0;
visibility: hidden;
transition: all 0.5s ease;
}
#jackpot-overlay.active {
opacity: 1;
visibility: visible;
}
.rays {
position: absolute;
width: 300%;
height: 300%;
background: conic-gradient(from 0deg, transparent 0%, rgba(255,215,0,0.08) 15%, transparent 30%);
animation: rotate 25s linear infinite;
z-index: 1;
}
.winner-frame {
position: relative;
z-index: 20;
width: 92%;
max-width: 380px;
background: rgba(0, 0, 0, 0.92);
backdrop-filter: blur(18px);
-webkit-backdrop-filter: blur(18px);
border: 2px solid #FFD700;
border-radius: 36px;
padding: 30px 12px;
text-align: center;
box-shadow: 0 0 50px rgba(0, 0, 0, 1);
overflow: hidden;
animation: entry 0.5s ease-out forwards;
}
.jackpot-header {
font-family: 'Goldman', cursive;
font-size: clamp(2.0rem, 9vw, 2.8rem);
background: linear-gradient(180deg, #FFD700 0%, #B8860B 100%);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
margin-bottom: 8px;
letter-spacing: 1.5px;
}
.username {
font-size: clamp(1.1rem, 5vw, 1.5rem);
color: #fff;
font-weight: 900;
margin-bottom: 14px;
display: block;
text-transform: uppercase;
}
.prize-box {
background: rgba(255, 215, 0, 0.08);
border: 1px solid rgba(255, 215, 0, 0.3);
border-radius: 18px;
padding: 20px 8px;
margin: 0 auto;
width: 92%;
display: flex;
justify-content: center;
align-items: center;
}
.prize-amount {
font-size: clamp(1.6rem, 8vw, 3.2rem);
font-weight: 900;
color: #fff;
text-shadow: 0 0 16px rgba(255, 215, 0, 0.8);
white-space: nowrap;
}
.badge-info {
margin-top: 16px;
font-weight: 700;
color: #FFD700;
font-size: 0.8rem;
text-transform: uppercase;
letter-spacing: 2px;
}
.coin {
position: absolute;
width: clamp(22px, 6vw, 40px);
height: clamp(22px, 6vw, 40px);
background: #FFD700;
border-radius: 50%;
border: 2px solid #B8860B;
display: flex;
justify-content: center;
align-items: center;
font-weight: bold;
color: #8b6508;
font-size: 12px;
pointer-events: none;
box-shadow: inset 0 0 6px rgba(0,0,0,0.4);
}
.front-coin { z-index: 30; }
.back-coin { z-index: 5; opacity: 0.7; }
@keyframes coinFall {
0% { transform: translateY(-15vh) rotate(0deg) translateX(0); }
25% { transform: translateY(15vh) rotate(180deg) translateX(12px); }
50% { transform: translateY(45vh) rotate(360deg) translateX(-12px); }
100% { transform: translateY(115vh) rotate(720deg) translateX(0); }
}
/* MOBILE EXTRA TUNING */
@media (max-width: 576px) {
.line-card, .line-frame, .bingo-card, .winner-frame {
padding-top: 24px;
padding-bottom: 24px;
}
.prize-chips, .chips-amount, .prize-amount {
line-height: 1.1;
}
}
</style>
</head>
<body>
<div class="container">
<div id="login-screen">
<div style="text-align: center; background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.4); max-width: 500px; margin: 60px auto; animation: fadeInUp 0.8s;">
<h1 style="font-size: 2.4em; margin-bottom: 20px; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">
üé∞ <strong>BINGO</strong> MULTIPLAYER üé∞
</h1>
<p style="margin-bottom: 20px; color: #fff; font-size: 1.1em;">Entre com seu nome e comece a jogar!</p>
<input
type="text"
id="player-name"
placeholder="Digite seu nome (2-15 letras)"
maxlength="15"
autocomplete="off"
style="padding: 14px; width: 80%; max-width: 300px; border: none; border-radius: 50px; font-size: 1.1em; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.2); outline: none;"
/>
<div style="margin-top: 25px; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
<button
onclick="joinRoom('bingo75')"
style="background: #ff9a00; color: white; padding: 12px 24px; border: none; border-radius: 50px; font-weight: bold; font-size: 1.1em; cursor: pointer; box-shadow: 0 4px 12px rgba(255,154,0,0.4); transition: all 0.3s; min-width: 140px;"
onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 16px rgba(255,154,0,0.6)';"
onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 12px rgba(255,154,0,0.4)';"
>
üá∫üá∏ Bingo 75
</button>
<button
onclick="joinRoom('bingo90')"
style="background: #e91e63; color: white; padding: 12px 24px; border: none; border-radius: 50px; font-weight: bold; font-size: 1.1em; cursor: pointer; box-shadow: 0 4px 12px rgba(233,30,99,0.4); transition: all 0.3s; min-width: 140px;"
onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 16px rgba(233,30,99,0.6)';"
onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 12px rgba(233,30,99,0.4)';"
>
üáßüá∑ Bingo 90
</button>
</div>
</div>
<style>
@keyframes fadeInUp {
from { opacity: 0; transform: translateY(30px); }
to { opacity: 1; transform: translateY(0); }
}
</style>
</div>
<div id="admin-message"></div>
<div id="admin-controls" style="display:none;margin:20px auto;max-width:500px;background:rgba(255,255,255,0.1);padding:15px;border-radius:8px;">
<h3>üîß Controles Administrativos</h3>
<input type="text" id="admin-player-name" placeholder="Nome do Jogador" style="margin:5px;padding:8px;width:calc(33%-10px);">
<input type="number" id="admin-amount" placeholder="Quantidade" style="margin:5px;padding:8px;width:calc(33%-10px);">
<input type="password" id="admin-password" placeholder="Senha" style="margin:5px;padding:8px;width:calc(33%-10px);">
<button onclick="sendAdminCommand()" style="margin:5px;padding:8px;">Enviar</button>
</div>
<div id="game-area">
<div class="header">
<h2 id="room-title">Sala: ?</h2>
<div class="player-info">
<span>Jogador: <strong id="player-name-display"></strong></span>
<span>Chips: <strong id="chips-display">0</strong></span>
</div>
<div id="pot-display">Pote: R$ 0</div>
<div id="jackpot-display">Jackpot: R$ 0</div>
</div>
<div class="players-section">
<div class="players-column">
<h3>Sem Chips (<span id="no-chips-count">0</span>)</h3>
<div class="players-list" id="without-chips-list">
<ul></ul>
</div>
</div>
<div class="players-column">
<h3>Com Chips (<span id="with-chips-count">0</span>)</h3>
<div class="players-list" id="with-chips-list">
<ul></ul>
</div>
</div>
</div>
<div class="ranking-section">
<h3>üèÜ Ranking por Chips</h3>
<div class="ranking-list">
<ul id="ranking-list"></ul>
</div>
</div>
<div class="controls" id="main-controls">
<label>
Cartelas:
<input type="number" id="card-count" min="1" max="10" value="1" style="width: 80px; padding: 4px;" inputmode="numeric">
</label>
<button onclick="document.getElementById('card-count').value = 10">10</button>
<button id="buy-btn">Comprar (100 chips/carta)</button>
<button id="start-btn">Iniciar Sorteio</button>
<button id="line1-btn">Linha 1</button>
<button id="line2-btn">Linha 2</button>
<button id="bingo-btn">BINGO!</button>
<button id="restart-btn">üîÑ Reiniciar</button>
</div>
<!-- ‚úÖ CHAT -->
<div id="chat-container">
<h3 style="text-align:center;margin-bottom:10px;color:gold;">üí¨ Chat da Sala</h3>
<div id="chat-messages"></div>
<div id="chat-input-container">
<input type="text" id="chat-input" placeholder="Converse com os bots...">
<button id="chat-send">Enviar</button>
</div>
</div>
<div class="draw-area">
<div>√öltimo n√∫mero: <span id="last-number">-</span></div>
<div>Bolas sorteadas: <span id="balls-count">0</span></div>
<div class="history" id="history"></div>
</div>
<div class="cards-container" id="cards-container"></div>
</div>
<!-- OVERLAYS DE ANIMA√á√ÉO -->
<!-- Linha 1 -->
<div id="line-victory-overlay">
<div class="line-card">
<h2 class="line-title">LINHA 1 COMPLETA!</h2>
<span class="winner-name" id="winner-display">?</span>
<div class="chips-box">
<div class="prize-chips" id="chip-counter">0</div>
<p class="chip-label">CHIPS</p>
</div>
<p style="font-size: 0.7rem; color: #555; letter-spacing: 2px;">BINGO MASTER PRO</p>
</div>
</div>
<!-- Linha 2 -->
<div id="line2-victory-overlay">
<div class="rays-emerald"></div>
<div class="line-frame">
<h1 class="line-header">LINHA 2!</h1>
<p style="font-size: 0.7rem; color: #888; letter-spacing: 3px; margin-bottom: 5px;">VENCEDOR</p>
<span class="winner-name" id="line2-winner-name">?</span>
<div class="chips-box">
<span class="chips-amount" id="line2-chips-text">0</span>
</div>
<p class="sub-label">CHIPS GANHOS</p>
</div>
</div>
<!-- Bingo -->
<div id="bingo-victory-overlay">
<div class="bingo-card">
<h1 class="bingo-title">BINGO!</h1>
<p style="font-size: 0.7rem; color: #888; letter-spacing: 3px;">VENCEDOR</p>
<span class="winner-name" id="bingo-winner-name">?</span>
<div class="prize-container">
<div class="prize-amount" id="bingo-prize-amount">R$ 0</div>
</div>
<p class="sub-tag">‚ú® CARTELA CHEIA ‚ú®</p>
</div>
</div>
<!-- Jackpot -->
<div id="jackpot-overlay">
<div class="rays"></div>
<div class="winner-frame">
<h1 class="jackpot-header">JACKPOT</h1>
<p style="font-size: 0.7rem; color: #888; letter-spacing: 3px;">VENCEDOR</p>
<span class="username" id="jackpot-winner-name">?</span>
<div class="prize-box">
<span class="prize-amount" id="jackpot-prize-amount">R$ 0</span>
</div>
<p class="badge-info" id="jackpot-balls-info">‚ú® BINGO EM ? BOLAS ‚ú®</p>
</div>
</div>
<script>
// ‚úÖ Web Worker embutido
const workerCode = `
self.onmessage = function(e) {
const { cards, drawnNumbers } = e.data;
function validateAndFixBingo90Card(card) {
if (!Array.isArray(card) || card.length !== 3) return null;
let count = 0;
for (let r = 0; r < 3; r++) {
if (!Array.isArray(card[r]) || card[r].length !== 9) return null;
for (let c = 0; c < 9; c++) {
if (typeof card[r][c] === 'number' && card[r][c] >= 1 && card[r][c] <= 90) count++;
}
}
return count === 15 ? card : null;
}
function checkCardAchievements(card, drawnNumbers) {
const markedInRow = [0, 0, 0];
for (let r = 0; r < 3; r++) {
for (let c = 0; c < 9; c++) {
const num = card[r][c];
if (num !== null && drawnNumbers.includes(num)) markedInRow[r]++;
}
}
const completeLines = markedInRow.filter(c => c === 5).length;
return { linha1: completeLines >= 1, linha2: completeLines >= 2, bingo: completeLines === 3 };
}
const results = [];
for (let i = 0; i < cards.length; i++) {
const validCard = validateAndFixBingo90Card(cards[i]);
if (validCard) {
const win = checkCardAchievements(validCard, drawnNumbers);
results.push({ index: i, valid: true, win });
} else {
results.push({ index: i, valid: false, win: null });
}
}
self.postMessage(results);
};
`;
let validationWorker = null;
if (window.Worker) {
const blob = new Blob([workerCode], { type: 'application/javascript' });
validationWorker = new Worker(URL.createObjectURL(blob));
}
// ‚úÖ √Åudio
let audioContext = null;
function playSound(type, number = null) {
try {
if (!audioContext) {
const AudioContext = window.AudioContext || window.webkitAudioContext;
if (!AudioContext) return;
audioContext = new AudioContext();
}
if (audioContext.state === 'suspended') audioContext.resume();
const ctx = audioContext;
const now = ctx.currentTime;
if (type === 'sorteio') {
const osc = ctx.createOscillator();
const gain = ctx.createGain();
osc.type = 'sine';
osc.frequency.setValueAtTime(300 + (number % 10) * 20, now);
gain.gain.setValueAtTime(0.15, now);
gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
osc.connect(gain);
gain.connect(ctx.destination);
osc.start(now);
osc.stop(now + 0.4);
} else if (type === 'linha1') {
const osc = ctx.createOscillator();
const gain = ctx.createGain();
osc.type = 'sine';
osc.frequency.setValueAtTime(880, now);
gain.gain.setValueAtTime(0.3, now);
gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
osc.connect(gain);
gain.connect(ctx.destination);
osc.start(now);
osc.stop(now + 0.3);
} else if (type === 'linha2') {
const osc1 = ctx.createOscillator();
const osc2 = ctx.createOscillator();
const gain = ctx.createGain();
osc1.type = 'sine';
osc2.type = 'triangle';
osc1.frequency.setValueAtTime(660, now);
osc2.frequency.setValueAtTime(1320, now);
gain.gain.setValueAtTime(0.25, now);
gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
osc1.connect(gain);
osc2.connect(gain);
gain.connect(ctx.destination);
osc1.start(now);
osc2.start(now);
osc1.stop(now + 0.5);
osc2.stop(now + 0.5);
} else if (type === 'bingo') {
const notes = [523, 659, 784, 1046];
notes.forEach((freq, i) => {
const osc = ctx.createOscillator();
const gain = ctx.createGain();
osc.type = 'sine';
osc.frequency.setValueAtTime(freq, now + i * 0.15);
gain.gain.setValueAtTime(0.2, now + i * 0.15);
gain.gain.exponentialRampToValueAtTime(0.01, now + i * 0.15 + 0.2);
osc.connect(gain);
gain.connect(ctx.destination);
osc.start(now + i * 0.15);
osc.stop(now + i * 0.15 + 0.2);
});
}
} catch (e) { console.warn('Erro ao reproduzir som:', e); }
}
function speak(text) {
if (!('speechSynthesis' in window)) return;
speechSynthesis.cancel();
const utterance = new SpeechSynthesisUtterance(text);
utterance.lang = 'pt-BR';
utterance.rate = 0.9;
speechSynthesis.speak(utterance);
}
// ‚úÖ Conquistas
let achievements = JSON.parse(localStorage.getItem('bingo_achievements') || '[]');
let totalCardsBought = 0;
let consecutiveWins = 0;
let lastWinType = null;
function checkAchievements(winType = null, cardsBought = 0, ballsCount = null) {
const newAchievements = [];
totalCardsBought += cardsBought;
if (totalCardsBought >= 1000 && !achievements.includes('coletor')) {
achievements.push('coletor');
newAchievements.push('üèÜ Colecionador: Comprou 1.000 cartelas!');
}
if (winType) {
if (winType === lastWinType) consecutiveWins++;
else { consecutiveWins = 1; lastWinType = winType; }
if (consecutiveWins >= 5 && !achievements.includes('invicto')) {
achievements.push('invicto');
newAchievements.push('üî• Invicto: 5 vit√≥rias seguidas!');
}
}
// ‚úÖ CORRIGIDO: usar 60 bolas
if (winType === 'bingo' && ballsCount <= 60 && !achievements.includes('sortudo')) {
achievements.push('sortudo');
newAchievements.push('üçÄ Sortudo: Ganhou o Jackpot!');
}
if (newAchievements.length > 0) {
localStorage.setItem('bingo_achievements', JSON.stringify(achievements));
newAchievements.forEach(msg => {
showAdminMessage(msg, 'success');
speak(msg.replace(/[^a-zA-Z√Ä-√ø\s]/g, ''));
});
}
}
// ‚úÖ Wake Lock
if ('wakeLock' in navigator) {
let wakeLock = null;
const requestWakeLock = async () => {
try { wakeLock = await navigator.wakeLock.request('screen'); } catch (err) { console.warn('Wake Lock:', err); }
};
document.addEventListener('DOMContentLoaded', requestWakeLock);
}
// ‚úÖ Gestos de toque
let touchStartX = 0;
document.addEventListener('touchstart', (e) => { touchStartX = e.touches[0].clientX; }, { passive: true });
document.addEventListener('touchend', (e) => {
if (!touchStartX) return;
const diff = touchStartX - e.changedTouches[0].clientX;
const container = document.getElementById('cards-container');
if (Math.abs(diff) > 50) {
container.scrollBy({ left: diff > 0 ? 300 : -300, behavior: 'smooth' });
}
touchStartX = 0;
}, { passive: true });
// ‚úÖ Vari√°veis globais
let socket = null;
let isAdminMode = false;
let currentRoom = '';
let cardType = '';
let playerCards = [];
let roomsDrawnNumbers = [];
let gameEnded = false;
let playerName = '';
let currentStage = 'linha1';

// ‚úÖ CONEX√ÉO
const SOCKET_URL = 'https://bingo-online-production.up.railway.app';
socket = io(SOCKET_URL, {
transports: ['websocket'],
reconnection: true,
reconnectionAttempts: Infinity
});

function toggleAdminMode() {
const controls = document.getElementById('admin-controls');
controls.style.display = isAdminMode ? 'none' : 'block';
isAdminMode = !isAdminMode;
}

function showAdminMessage(message, type = 'info') {
const msgElement = document.getElementById('admin-message');
msgElement.textContent = message;
msgElement.style.display = 'block';
msgElement.style.background = type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3';
setTimeout(() => msgElement.style.display = 'none', 5000);
}

function sendAdminCommand() {
const playerName = document.getElementById('admin-player-name').value;
const amount = parseInt(document.getElementById('admin-amount').value);
const password = document.getElementById('admin-password').value;
if (!playerName || isNaN(amount) || !password) {
alert('Preencha todos os campos.');
return;
}
socket.emit('admin-add-chips', { playerName, amount, adminPassword: password });
document.getElementById('admin-player-name').value = '';
document.getElementById('admin-amount').value = '';
document.getElementById('admin-password').value = '';
}

let clickCount = 0;
let clickTimer = null;
document.getElementById('player-name').addEventListener('click', function() {
clickCount++;
if (clickTimer) clearTimeout(clickTimer);
clickTimer = setTimeout(() => clickCount = 0, 500);
if (clickCount === 5) {
toggleAdminMode();
clickCount = 0;
clearTimeout(clickTimer);
}
});

function loadGameState(name) {
try {
const saved = localStorage.getItem(`bingo_player_${name}`);
if (!saved) return null;
const data = JSON.parse(saved);
if (typeof data.chips !== 'number' || data.chips < 0) data.chips = 10000;
if (!Array.isArray(data.cards90)) data.cards90 = [];
if (!Array.isArray(data.cards75)) data.cards75 = [];
return data;
} catch (e) {
console.warn('Erro ao carregar estado. Limpando.');
localStorage.removeItem(`bingo_player_${name}`);
return null;
}
}

function saveGameState(name, chips, cards75, cards90) {
try {
localStorage.setItem(`bingo_player_${name}`, JSON.stringify({ chips, cards75, cards90 }));
} catch (e) {
console.warn('N√£o foi poss√≠vel salvar o estado do jogo:', e);
}
}

// ‚úÖ Fun√ß√£o corrigida: conta bolas faltantes PARA A FASE ATUAL
function getBallsLeftForCurrentStage(card, drawnNumbers, stage) {
if (!card || card.length !== 3) return Infinity;
const markedInRow = [0, 0, 0];
for (let r = 0; r < 3; r++) {
for (let c = 0; c < 9; c++) {
if (card[r][c] !== null && drawnNumbers.includes(card[r][c])) {
markedInRow[r]++;
}
}
}
if (stage === 'linha1') {
const completed = markedInRow.filter(c => c === 5).length;
if (completed >= 1) return 0;
return Math.min(5 - markedInRow[0], 5 - markedInRow[1], 5 - markedInRow[2]);
}
else if (stage === 'linha2') {
const completed = markedInRow.filter(c => c === 5).length;
if (completed >= 2) return 0;
if (completed === 0) {
const sorted = [...markedInRow].sort((a, b) => b - a);
return (5 - sorted[0]) + (5 - sorted[1]);
}
// Se j√° tem 1 linha, falta completar outra
const incomplete = markedInRow.filter(c => c < 5);
return Math.min(...incomplete.map(c => 5 - c));
}
else if (stage === 'bingo') {
const totalMarked = markedInRow.reduce((a, b) => a + b, 0);
return Math.max(0, 15 - totalMarked);
}
return Infinity;
}

function updateControlButtons(stage) {
if (!stage) return;
currentStage = stage;
document.getElementById('main-controls').className = `controls stage-${stage}`;
}

// ‚úÖ Adicionar mensagem no chat
function addChatMessage(text, sender, isBot = false, isSystem = false) {
const chatMessages = document.getElementById('chat-messages');
const p = document.createElement('p');
p.textContent = `${sender}: ${text}`;
if (isSystem) {
p.className = 'system';
} else if (isBot) {
p.className = 'bot';
} else {
p.className = 'human';
}
chatMessages.appendChild(p);
chatMessages.scrollTop = chatMessages.scrollHeight;
}

// ‚úÖ Enviar mensagem do usu√°rio
document.getElementById('chat-send').addEventListener('click', () => {
const input = document.getElementById('chat-input');
const msg = input.value.trim();
if (!msg) return;
socket.emit('chat-message', {
message: msg,
sender: playerName,
isBot: false
});
input.value = '';
});
document.getElementById('chat-input').addEventListener('keypress', (e) => {
if (e.key === 'Enter') {
document.getElementById('chat-send').click();
}
});

document.addEventListener('DOMContentLoaded', () => {
function initAudio() {
if (!audioContext) {
const AudioContext = window.AudioContext || window.webkitAudioContext;
if (AudioContext) {
audioContext = new AudioContext();
}
}
document.body.removeEventListener('click', initAudio);
document.body.removeEventListener('touchstart', initAudio);
}
document.body.addEventListener('click', initAudio);
document.body.addEventListener('touchstart', initAudio);

const playerNameInput = document.getElementById('player-name');
const loginScreen = document.getElementById('login-screen');
const gameArea = document.getElementById('game-area');
const potDisplay = document.getElementById('pot-display');
const jackpotDisplay = document.getElementById('jackpot-display');
const ballsCountDisplay = document.getElementById('balls-count');

window.joinRoom = function(roomType) {
let name = playerNameInput.value.trim();
name = name.replace(/[^a-zA-Z√Ä-√ø\s]/g, '').substring(0, 15).trim() || 'An√¥nimo';
if (name === 'An√¥nimo' || name.length < 2) {
alert('Nome inv√°lido. Use apenas letras (2-15 caracteres).');
return;
}
playerName = name;
const savedState = loadGameState(name);
const savedCards75 = savedState ? savedState.cards75 : null;
const savedCards90 = savedState ? savedState.cards90 : null;
const savedChips = savedState ? savedState.chips : null;
socket.emit('join-room', { playerName: name, roomType, savedChips, savedCards75, savedCards90 });
};

socket.on('room-welcome', (data) => {
currentRoom = data.roomId;
cardType = currentRoom === 'bingo75' ? '75' : '90';
loginScreen.style.display = 'none';
gameArea.style.display = 'block';
document.getElementById('room-title').textContent = `Sala: ${data.roomName}`;
gameEnded = data.gameCompleted || false;
updateControlButtons(data.currentStage || 'linha1');
});

socket.on('room-state', (data) => {
document.getElementById('player-name-display').textContent = data.players[socket.id]?.name || '?';
const chips = data.players[socket.id]?.chips || 10000;
document.getElementById('chips-display').textContent = chips.toLocaleString('pt-BR');
roomsDrawnNumbers = data.drawnNumbers || [];
ballsCountDisplay.textContent = roomsDrawnNumbers.length;
updateHistory(data.drawnNumbers || []);
if (data.lastNumber) document.getElementById('last-number').textContent = data.lastNumber;
updateControlButtons(data.currentStage || 'linha1');
const player = data.players[socket.id];
if (player) saveGameState(playerName, player.chips, player.cards75, player.cards90);
});

socket.on('pot-update', (data) => {
potDisplay.textContent = `Pote: R$ ${data.pot.toLocaleString('pt-BR')}`;
jackpotDisplay.textContent = `Jackpot: R$ ${data.jackpot.toLocaleString('pt-BR')}`;
});

socket.on('player-list', (data) => {
const withoutList = document.getElementById('without-chips-list').querySelector('ul');
const withList = document.getElementById('with-chips-list').querySelector('ul');
withoutList.innerHTML = '';
withList.innerHTML = '';
document.getElementById('no-chips-count').textContent = data.withoutChips.length;
document.getElementById('with-chips-count').textContent = data.withChips.length;
data.withoutChips.forEach(p => {
const li = document.createElement('li');
li.textContent = p.name;
li.classList.add('x-out');
withoutList.appendChild(li);
});
data.withChips.forEach(p => {
const li = document.createElement('li');
li.innerHTML = `<span>${p.name}</span><span>R$ ${p.chips.toLocaleString('pt-BR')}</span>`;
if (p.currentWins > 0) li.classList.add('winner');
withList.appendChild(li);
});
});

socket.on('ranking-update', (ranking) => {
const rankingList = document.getElementById('ranking-list');
rankingList.innerHTML = '';
ranking.forEach(player => {
const li = document.createElement('li');
li.innerHTML = `
<div class="ranking-position">${player.position}¬∫</div>
<div class="ranking-name">${player.name}</div>
<div class="ranking-chips">R$ ${player.chips.toLocaleString('pt-BR')}</div>
`;
rankingList.appendChild(li);
});
});

socket.on('update-player', (data) => {
document.getElementById('chips-display').textContent = data.chips.toLocaleString('pt-BR');
const currentState = loadGameState(playerName) || {};
saveGameState(playerName, data.chips, currentState.cards75 || [], currentState.cards90 || []);
});

// ‚úÖ Receber mensagens do chat ‚Äî agora reconhece "SYSTEM"
socket.on('chat-message', (data) => {
const isSystem = (data.sender === "SYSTEM");
addChatMessage(data.message, data.sender, data.isBot, isSystem);
});

socket.on('cards-received', (data) => {
const newCards = data.cards.map(cardObj => ({
card: cardObj.card,
originalIndex: playerCards.length
}));
playerCards = playerCards.concat(newCards);
const currentState = loadGameState(playerName) || {};
if (data.cardType === '75') {
currentState.cards75 = currentState.cards75 || [];
data.cards.forEach(c => currentState.cards75.push(c.card));
} else {
currentState.cards90 = currentState.cards90 || [];
data.cards.forEach(c => currentState.cards90.push(c.card));
}
saveGameState(playerName, currentState.chips || 10000, currentState.cards75, currentState.cards90);
requestAnimationFrame(() => {
renderCards();
roomsDrawnNumbers.forEach(num => markDrawnNumbers(num));
});
});

socket.on('number-drawn', (data) => {
document.getElementById('last-number').textContent = data.number;
roomsDrawnNumbers = data.drawnNumbers;
ballsCountDisplay.textContent = roomsDrawnNumbers.length;
updateHistory(data.drawnNumbers);
markDrawnNumbers(data.number);
renderCards();
playSound('sorteio', data.number);
speak(data.number.toString());
});

socket.on('player-won', (data) => {
if (data.winners[0].winType === 'linha1') {
playSound('linha1');
speak(`Linha 1 ganha por ${data.winnerNames}!`);
checkAchievements('linha1', 0);
showLineVictory(data.totalPrize, data.winnerNames);
} else if (data.winners[0].winType === 'linha2') {
playSound('linha2');
speak(`Linhas completas por ${data.winnerNames}!`);
checkAchievements('linha2', 0);
showLine2Victory(data.totalPrize, data.winnerNames);
} else if (data.winners[0].winType === 'bingo') {
playSound('bingo');
speak(`Bingo feito por ${data.winnerNames}!`);
checkAchievements('bingo', 0, data.ballsCount);
showBingoVictory(data.totalPrize, data.winnerNames);
}
if (data.newStage) updateControlButtons(data.newStage);
if (data.winners[0].winType === 'bingo') gameEnded = true;
});

socket.on('jackpot-won', (data) => {
showJackpotVictory(data.jackpotAmount, data.winnerNames, data.ballsCount);
});

socket.on('show-restart-button', () => { gameEnded = true; });

socket.on('game-over', () => { gameEnded = true; });

socket.on('room-reset', () => {
roomsDrawnNumbers = [];
playerCards = [];
gameEnded = false;
document.getElementById('cards-container').innerHTML = '';
document.getElementById('last-number').textContent = '-';
document.getElementById('balls-count').textContent = '0';
document.getElementById('history').innerHTML = '';
document.getElementById('chat-messages').innerHTML = '';
localStorage.removeItem(`bingo_player_${playerName}`);
renderCards();
updateControlButtons('linha1');
});

socket.on('error', (msg) => showAdminMessage(msg, 'error'));
socket.on('message', (msg) => showAdminMessage(msg, 'success'));

// ‚úÖ Eventos de compra e controles
document.getElementById('buy-btn').addEventListener('click', () => {
if (gameEnded) {
alert('O jogo terminou. Clique em "Reiniciar Jogo".');
return;
}
const count = parseInt(document.getElementById('card-count').value) || 1;
if (count < 1 || count > 10) {
alert('Digite um valor entre 1 e 10.');
return;
}
socket.emit('buy-cards', { count, cardType });
});

document.getElementById('start-btn').addEventListener('click', () => {
if (gameEnded) return;
socket.emit('start-draw');
});

document.getElementById('line1-btn').addEventListener('click', () => {
if (gameEnded) return;
socket.emit('claim-win', { winType: 'linha1' });
});

document.getElementById('line2-btn').addEventListener('click', () => {
if (gameEnded) return;
socket.emit('claim-win', { winType: 'linha2' });
});

document.getElementById('bingo-btn').addEventListener('click', () => {
if (gameEnded) return;
socket.emit('claim-win', { winType: 'bingo' });
});

document.getElementById('restart-btn').addEventListener('click', () => {
if (confirm('Deseja reiniciar o jogo?')) {
socket.emit('restart-game');
}
});

window.addEventListener('beforeunload', (e) => {
if (currentRoom && !gameEnded) {
e.preventDefault();
e.returnValue = '';
return '';
}
});

function updateHistory(numbers) {
const hist = document.getElementById('history');
hist.innerHTML = '';
[...numbers].reverse().forEach(num => {
const span = document.createElement('span');
span.className = 'ball';
span.textContent = num;
hist.appendChild(span);
});
}

function markDrawnNumbers(number) {
const numStr = String(number);
document.querySelectorAll(`.cell[data-num="${numStr}"]`).forEach(cell => {
cell.classList.add('marked');
});
}

function renderCards() {
const container = document.getElementById('cards-container');
container.innerHTML = '';

const validCards = playerCards.filter(item =>
item && item.card &&
((cardType === '75' && item.card.length === 25) ||
(cardType === '90' && item.card.length === 3 && item.card.every(row => Array.isArray(row) && row.length === 9)))
);

// ‚úÖ Ordenar: primeiro as que faltam 1 bola para a fase atual
const sortedCards = [...validCards].sort((a, b) => {
const ballsA = getBallsLeftForCurrentStage(a.card, roomsDrawnNumbers, currentStage);
const ballsB = getBallsLeftForCurrentStage(b.card, roomsDrawnNumbers, currentStage);
// Prioriza quem tem 1 bola faltando
if (ballsA === 1 && ballsB !== 1) return -1;
if (ballsB === 1 && ballsA !== 1) return 1;
return ballsA - ballsB;
});

sortedCards.forEach((item, idx) => {
item.index = idx;
});

sortedCards.forEach(item => {
const wrapper = document.createElement('div');
wrapper.className = 'card-wrapper';

const ballsLeft = getBallsLeftForCurrentStage(item.card, roomsDrawnNumbers, currentStage);
// ‚úÖ S√≥ aplica near-win se faltar EXATAMENTE 1 bola para a fase atual
if (ballsLeft === 1) {
wrapper.classList.add('near-win');
}

wrapper.innerHTML = `<div class="card-title">Cartela ${item.index + 1}</div>`;
const grid = document.createElement('div');
grid.className = cardType === '75' ? 'grid-75' : 'grid-90';

if (cardType === '90') {
const markedInRow = [0, 0, 0];
for (let r = 0; r < 3; r++) {
for (let c = 0; c < 9; c++) {
const num = item.card[r][c];
if (num !== null && roomsDrawnNumbers.includes(num)) {
markedInRow[r]++;
}
}
}
const completedLines = [];
if (markedInRow[0] >= 5) completedLines.push(0);
if (markedInRow[1] >= 5) completedLines.push(1);
if (markedInRow[2] >= 5) completedLines.push(2);
const bingo = completedLines.length >= 3;

for (let r = 0; r < 3; r++) {
for (let c = 0; c < 9; c++) {
const cell = document.createElement('div');
cell.className = 'cell';
const val = item.card[r][c];
if (val !== null) {
cell.textContent = val.toString();
cell.dataset.num = val.toString();
if (roomsDrawnNumbers.includes(val)) {
cell.classList.add('marked');
}
if (bingo) {
// ser√° tratado no wrapper
} else if (completedLines.length >= 2) {
if (completedLines.includes(r)) {
cell.style.backgroundColor = '#8e44ad';
cell.style.color = 'white';
}
} else if (completedLines.length >= 1 && completedLines[0] === r) {
cell.style.backgroundColor = '#27ae60';
cell.style.color = 'white';
}
} else {
cell.classList.add('empty');
}
grid.appendChild(cell);
}
}
if (bingo) {
wrapper.className = 'card-wrapper bingo-complete';
const overlay = document.createElement('div');
overlay.className = 'bingo-overlay';
overlay.textContent = 'BINGO!';
wrapper.appendChild(overlay);
}
} else {
for (let i = 0; i < 25; i++) {
const cell = document.createElement('div');
cell.className = 'cell';
if (item.card[i] === 'FREE') {
cell.textContent = '‚òÖ';
cell.classList.add('free');
} else {
cell.textContent = item.card[i].toString();
cell.dataset.num = item.card[i].toString();
if (roomsDrawnNumbers.includes(item.card[i])) {
cell.classList.add('marked');
}
}
grid.appendChild(cell);
}
}
wrapper.appendChild(grid);
container.appendChild(wrapper);
});

if (cardType === '90' && sortedCards.length > 0 && validationWorker) {
const cardsToValidate = sortedCards.slice(0, 100).map(item => item.card);
validationWorker.postMessage({ cards: cardsToValidate, drawnNumbers: roomsDrawnNumbers });
validationWorker.onmessage = (e) => {
const results = e.data;
const wrappers = container.querySelectorAll('.card-wrapper');
results.forEach((res, idx) => {
if (idx < wrappers.length) {
const wrapper = wrappers[idx];
if (!res.valid) {
wrapper.style.opacity = '0.6';
wrapper.title = 'Cartela inv√°lida (‚â†15 n√∫meros)';
}
}
});
};
}
});
</script>
</body>
</html>
